<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>小念头教学AR版</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { text-align: center; font-family: sans-serif; background: #f9f9f9; }
    h1 { margin-top: 15px; }
    model-viewer { width: 100%; height: 75vh; background-color: #000; }
    .controls { margin-top: 10px; }
    button { padding: 10px 15px; font-size: 16px; margin: 5px; }
  </style>
</head>
<body>

  <h1>小念头教学AR版</h1>
  <p>点击按钮可调速、播放/暂停，支持AR浏览</p>

  <model-viewer id="mv"
    src="wingchun.glb"
    animation-name="wingchun"
    autoplay
    ar
    ar-modes="webxr scene-viewer quick-look"
    camera-controls
    exposure="1"
    shadow-intensity="1"
    environment-image="neutral"
    style="--poster-color: transparent; background-color: #000;"
  >
  </model-viewer>

  <div class="controls">
    <button onclick="setSpeed(0.2)">0.2x 超慢</button>
    <button onclick="setSpeed(0.5)">0.5x 慢速</button>
    <button onclick="setSpeed(1)">1x 正常</button>
    <button onclick="setSpeed(2)">2x 快速</button>
    <br>
    <button onclick="togglePlay()">播放 / 暂停</button>
  </div>

  <script>
    const viewer = document.querySelector('#mv');

    // 默认关闭自动旋转
    viewer.addEventListener("load", () => {
      viewer.autoRotate = false;
      viewer.animationName = "wingchun";
    });

    // ✅ 修复后的倍速函数（唯一修改的地方）
    function setSpeed(rate) {
      viewer.pause();                  // 先暂停确保动画重置
      viewer.animationSpeed = rate;    // 设置倍速
      viewer.currentTime = 0;          // 从头开始播放，确保倍速效果明显
      viewer.play();                   // 重新播放
      viewer.autoRotate = false;       // 保证不自动旋转
    }

    // 播放/暂停切换（不变）
    function togglePlay() {
      if (viewer.paused) {
        viewer.play();
      } else {
        viewer.pause();
      }
    }
  </script>

</body>
</html>
